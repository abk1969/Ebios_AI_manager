/**
 * üîó INT√âGRATION ATELIER 2 ‚Üí ATELIER 3
 * Syst√®me de transmission structur√© des sources de risque A2 vers sc√©narios A3
 */

// üéØ TYPES POUR L'INT√âGRATION A2 ‚Üí A3
export interface Workshop2Deliverable {
  id: string;
  type: 'external_source' | 'internal_source' | 'supply_chain_source' | 'threat_intelligence';
  name: string;
  priority: number; // 1-4
  description: string;
  motivations: string[];
  capabilities: SourceCapabilities;
  targets: string[];
  scenarioOrientations: string[];
}

export interface SourceCapabilities {
  technical: number; // 1-10
  organizational: number; // 1-10
  financial: number; // 1-10
  sectoral: number; // 1-10 (connaissance sant√©)
  sophistication: number; // 1-10
}

export interface PrioritizedSource {
  id: string;
  name: string;
  category: 'external' | 'internal' | 'supply_chain';
  priority: number;
  score: number; // Score global de menace
  motivations: SourceMotivation[];
  capabilities: SourceCapabilities;
  targetedAssets: string[];
  operatingModes: OperatingMode[];
  relevantScenarios: string[];
}

export interface SourceMotivation {
  type: 'financial' | 'ideological' | 'geopolitical' | 'personal' | 'opportunistic';
  description: string;
  intensity: number; // 1-5
  examples: string[];
}

export interface OperatingMode {
  technique: string;
  description: string;
  sophistication: number; // 1-5
  frequency: string;
  examples: string[];
}

export interface Workshop3Orientation {
  strategicScenarios: StrategicScenario[];
  sourceToEventMapping: SourceEventMapping[];
  capacityCalibration: CapacityCalibration[];
  scenarioPrioritization: ScenarioPriority[];
}

export interface StrategicScenario {
  id: string;
  title: string;
  description: string;
  primarySource: string;
  secondarySources: string[];
  targetedAssets: string[];
  expectedImpact: string;
  likelihood: number; // 1-5
  sophisticationRequired: number; // 1-5
}

export interface SourceEventMapping {
  sourceId: string;
  sourceName: string;
  dreaded_events: DreadedEvent[];
}

export interface DreadedEvent {
  event: string;
  impact: 'CATASTROPHIQUE' | 'CRITIQUE' | 'MAJEUR' | 'MOD√âR√â' | 'MINEUR';
  likelihood: number; // 1-5
  justification: string;
}

export interface CapacityCalibration {
  securityObjective: string;
  requiredCapacities: string[];
  sophisticationLevel: number; // 1-10
  examples: string[];
}

export interface ScenarioPriority {
  scenario: string;
  priority: number; // 1-5
  justification: string;
  relatedSources: string[];
  impactLevel: string;
}

/**
 * üéØ CLASSE PRINCIPALE D'INT√âGRATION A2 ‚Üí A3
 */
export class Workshop2ToWorkshop3Integration {
  
  // üìä SOURCES PRIORIS√âES ISSUES DE L'ATELIER 2
  static getPrioritizedSources(): PrioritizedSource[] {
    return [
      {
        id: 'cybercriminals_health_specialized',
        name: 'Cybercriminels sp√©cialis√©s sant√©',
        category: 'external',
        priority: 1,
        score: 20,
        motivations: [
          {
            type: 'financial',
            description: 'Ran√ßons √©lev√©es secteur sant√© (1-10M‚Ç¨)',
            intensity: 5,
            examples: ['LockBit 3.0 CHU europ√©ens', 'Conti successeurs']
          },
          {
            type: 'opportunistic',
            description: 'Pression maximale paiement (vies en jeu)',
            intensity: 5,
            examples: ['Urgences ferm√©es', 'Blocs op√©ratoires arr√™t√©s']
          }
        ],
        capabilities: {
          technical: 9,
          organizational: 8,
          financial: 8,
          sectoral: 9,
          sophistication: 9
        },
        targetedAssets: [
          'Urgences vitales',
          'SIH Dossiers patients',
          'PACS Imagerie',
          'Centre de donn√©es'
        ],
        operatingModes: [
          {
            technique: 'Ransomware double extorsion',
            description: 'Chiffrement + menace publication donn√©es',
            sophistication: 5,
            frequency: 'Hebdomadaire',
            examples: ['LockBit 3.0', 'BlackCat/ALPHV']
          },
          {
            technique: 'Supply chain compromise',
            description: 'Compromission fournisseurs SIH',
            sophistication: 4,
            frequency: 'Mensuelle',
            examples: ['√âditeurs logiciels', 'MSP sant√©']
          }
        ],
        relevantScenarios: [
          'Ransomware paralysant urgences vitales',
          'Chiffrement SIH avec exfiltration donn√©es',
          'Attaque coordonn√©e multi-sites CHU',
          'Double extorsion avec leak patients VIP'
        ]
      },
      {
        id: 'foreign_states_espionage',
        name: '√âtats √©trangers - Espionnage recherche',
        category: 'external',
        priority: 2,
        score: 19,
        motivations: [
          {
            type: 'geopolitical',
            description: 'Espionnage recherche m√©dicale strat√©gique',
            intensity: 4,
            examples: ['Recherche COVID-19', 'Vaccins innovants']
          },
          {
            type: 'financial',
            description: 'Avantage concurrentiel √©conomique',
            intensity: 4,
            examples: ['Propri√©t√© intellectuelle', 'Brevets pharmaceutiques']
          }
        ],
        capabilities: {
          technical: 10,
          organizational: 10,
          financial: 10,
          sectoral: 7,
          sophistication: 10
        },
        targetedAssets: [
          'Recherche clinique',
          'SIH Dossiers patients',
          'PACS Imagerie',
          'Donn√©es gouvernementales'
        ],
        operatingModes: [
          {
            technique: 'APT persistante long terme',
            description: 'Infiltration discr√®te >2 ans',
            sophistication: 5,
            frequency: 'Continue',
            examples: ['APT40 recherche COVID', 'APT29 laboratoires']
          },
          {
            technique: 'Spear phishing cibl√©',
            description: 'Emails personnalis√©s chercheurs',
            sophistication: 4,
            frequency: 'Quotidienne',
            examples: ['Faux appels √† projets', 'Invitations conf√©rences']
          }
        ],
        relevantScenarios: [
          'Exfiltration recherche COVID/vaccins',
          'Espionnage donn√©es patients politiques',
          'Sabotage essais cliniques concurrents',
          'Infiltration long terme syst√®mes recherche'
        ]
      },
      {
        id: 'privileged_internal_threats',
        name: 'Menaces internes privil√©gi√©es',
        category: 'internal',
        priority: 3,
        score: 18,
        motivations: [
          {
            type: 'financial',
            description: 'Revente donn√©es patients march√© noir',
            intensity: 4,
            examples: ['250‚Ç¨/dossier complet', 'R√©seaux dark web']
          },
          {
            type: 'personal',
            description: 'Vengeance suite licenciement/sanction',
            intensity: 3,
            examples: ['Sabotage syst√®mes', 'Fuite donn√©es sensibles']
          }
        ],
        capabilities: {
          technical: 7,
          organizational: 6,
          financial: 3,
          sectoral: 10,
          sophistication: 6
        },
        targetedAssets: [
          'Tous biens essentiels (acc√®s privil√©gi√©)',
          'SIH Dossiers patients',
          'Centre de donn√©es',
          'Syst√®mes administration'
        ],
        operatingModes: [
          {
            technique: 'Abus privil√®ges l√©gitimes',
            description: 'Utilisation acc√®s autoris√©s √† des fins ill√©gitimes',
            sophistication: 3,
            frequency: 'Opportuniste',
            examples: ['Admin IT acc√®s root', 'M√©decin consultation massive']
          },
          {
            technique: 'Exfiltration discr√®te',
            description: 'Vol donn√©es par petites quantit√©s',
            sophistication: 4,
            frequency: 'Continue',
            examples: ['USB personnelles', 'Email personnel']
          }
        ],
        relevantScenarios: [
          'Administrateur IT compromet infrastructure',
          'M√©decin revend donn√©es patients',
          'Sabotage interne suite licenciement',
          'N√©gligence critique exposant syst√®mes'
        ]
      }
    ];
  }

  // üéØ ORIENTATIONS POUR ATELIER 3
  static getWorkshop3Orientations(): Workshop3Orientation {
    return {
      strategicScenarios: [
        {
          id: 'ransomware_emergency_paralysis',
          title: 'Ransomware paralysant urgences vitales',
          description: 'Attaque ransomware cibl√©e paralysant les urgences pendant >4h',
          primarySource: 'cybercriminals_health_specialized',
          secondarySources: ['supply_chain_compromise', 'internal_negligence'],
          targetedAssets: ['Urgences vitales', 'SIH Principal', 'PACS'],
          expectedImpact: 'CATASTROPHIQUE - Vies en jeu, responsabilit√© p√©nale',
          likelihood: 4,
          sophisticationRequired: 7
        },
        {
          id: 'medical_research_espionage',
          title: 'Espionnage recherche m√©dicale strat√©gique',
          description: 'Exfiltration discr√®te donn√©es recherche COVID/vaccins sur 2 ans',
          primarySource: 'foreign_states_espionage',
          secondarySources: ['internal_corruption', 'supply_chain_infiltration'],
          targetedAssets: ['Recherche clinique', 'Donn√©es patients VIP'],
          expectedImpact: 'CRITIQUE - Perte avantage concurrentiel national',
          likelihood: 3,
          sophisticationRequired: 9
        },
        {
          id: 'massive_patient_data_breach',
          title: 'Fuite massive donn√©es patients',
          description: 'Exfiltration 500k dossiers patients avec publication dark web',
          primarySource: 'privileged_internal_threats',
          secondarySources: ['cybercriminals_health_specialized', 'supply_chain_compromise'],
          targetedAssets: ['SIH Dossiers patients', 'PACS Imagerie'],
          expectedImpact: 'CRITIQUE - Sanctions RGPD, perte confiance',
          likelihood: 4,
          sophisticationRequired: 5
        }
      ],
      sourceToEventMapping: [
        {
          sourceId: 'cybercriminals_health_specialized',
          sourceName: 'Cybercriminels sp√©cialis√©s sant√©',
          dreaded_events: [
            {
              event: 'Arr√™t urgences vitales >4h',
              impact: 'CATASTROPHIQUE',
              likelihood: 4,
              justification: 'Sp√©cialisation sant√© + motivation financi√®re forte'
            },
            {
              event: 'Paralysie SIH >24h',
              impact: 'CRITIQUE',
              likelihood: 4,
              justification: 'Cible privil√©gi√©e ransomware, techniques √©prouv√©es'
            },
            {
              event: 'Fuite 500k dossiers patients',
              impact: 'CRITIQUE',
              likelihood: 3,
              justification: 'Double extorsion standard, pression maximale'
            }
          ]
        },
        {
          sourceId: 'foreign_states_espionage',
          sourceName: '√âtats √©trangers - Espionnage',
          dreaded_events: [
            {
              event: 'Vol recherche strat√©gique',
              impact: 'CRITIQUE',
              likelihood: 3,
              justification: 'Int√©r√™t g√©opolitique confirm√©, capacit√©s √©tatiques'
            },
            {
              event: 'Espionnage donn√©es gouvernementales',
              impact: 'CRITIQUE',
              likelihood: 2,
              justification: 'Patients VIP, informations sensibles'
            }
          ]
        }
      ],
      capacityCalibration: [
        {
          securityObjective: 'Disponibilit√© 99.99% urgences',
          requiredCapacities: [
            'DDoS massifs >100Gbps',
            'Ransomware avec destruction sauvegardes',
            'Coordination multi-vecteurs simultan√©s'
          ],
          sophisticationLevel: 8,
          examples: ['LockBit 3.0 campagne coordonn√©e', 'Botnet Mirai m√©dical']
        },
        {
          securityObjective: 'Int√©grit√© 100% prescriptions',
          requiredCapacities: [
            'Acc√®s privil√©gi√© bases donn√©es',
            'Modification discr√®te sans d√©tection',
            'Connaissance protocoles m√©dicaux'
          ],
          sophisticationLevel: 6,
          examples: ['Corruption admin IT', 'Malware cibl√© SIH']
        }
      ],
      scenarioPrioritization: [
        {
          scenario: 'Ransomware paralysant urgences vitales',
          priority: 1,
          justification: 'Vies en jeu + probabilit√© √©lev√©e + impact maximal',
          relatedSources: ['cybercriminals_health_specialized'],
          impactLevel: 'CATASTROPHIQUE'
        },
        {
          scenario: 'Fuite massive donn√©es patients',
          priority: 2,
          justification: 'Probabilit√© √©lev√©e + sanctions RGPD + perte confiance',
          relatedSources: ['privileged_internal_threats', 'cybercriminals_health_specialized'],
          impactLevel: 'CRITIQUE'
        },
        {
          scenario: 'Espionnage recherche m√©dicale',
          priority: 3,
          justification: 'Enjeu strat√©gique + sophistication √©tatique',
          relatedSources: ['foreign_states_espionage'],
          impactLevel: 'CRITIQUE'
        }
      ]
    };
  }

  // üîÑ M√âTHODES DE TRANSFORMATION A2 ‚Üí A3
  static transformSourcesToScenarios(): StrategicScenario[] {
    const sources = this.getPrioritizedSources();
    const scenarios: StrategicScenario[] = [];
    
    sources.forEach(source => {
      source.relevantScenarios.forEach(scenarioTitle => {
        scenarios.push({
          id: `scenario_${source.id}_${scenarios.length}`,
          title: scenarioTitle,
          description: `Sc√©nario impliquant ${source.name}`,
          primarySource: source.id,
          secondarySources: [],
          targetedAssets: source.targetedAssets,
          expectedImpact: this.calculateImpact(source.score),
          likelihood: Math.min(5, Math.floor(source.score / 4)),
          sophisticationRequired: source.capabilities.sophistication
        });
      });
    });
    
    return scenarios;
  }

  static calculateImpact(score: number): string {
    if (score >= 18) return 'CATASTROPHIQUE';
    if (score >= 15) return 'CRITIQUE';
    if (score >= 12) return 'MAJEUR';
    if (score >= 8) return 'MOD√âR√â';
    return 'MINEUR';
  }

  static generateHandoverDocument(): any {
    return {
      prioritizedSources: this.getPrioritizedSources(),
      workshop3Orientations: this.getWorkshop3Orientations(),
      strategicScenarios: this.transformSourcesToScenarios(),
      metadata: {
        generatedAt: new Date().toISOString(),
        version: '1.0',
        workshop: 'A2 ‚Üí A3 Integration',
        status: 'Ready for Workshop 3',
        totalSources: this.getPrioritizedSources().length,
        totalScenarios: this.getWorkshop3Orientations().strategicScenarios.length
      }
    };
  }

  static getSourceById(sourceId: string): PrioritizedSource | undefined {
    return this.getPrioritizedSources().find(source => source.id === sourceId);
  }

  static getScenariosByPriority(priority: number): StrategicScenario[] {
    return this.getWorkshop3Orientations().strategicScenarios
      .filter(scenario => scenario.likelihood >= priority)
      .sort((a, b) => b.likelihood - a.likelihood);
  }
}
