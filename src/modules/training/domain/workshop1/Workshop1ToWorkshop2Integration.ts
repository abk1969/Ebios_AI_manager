/**
 * üîó INT√âGRATION ATELIER 1 ‚Üí ATELIER 2
 * Syst√®me de transmission structur√© des livrables A1 vers A2
 */

// üéØ TYPES POUR L'INT√âGRATION A1 ‚Üí A2
export interface Workshop1Deliverable {
  id: string;
  type: 'context' | 'essential_assets' | 'ecosystem' | 'security_objectives';
  name: string;
  criticality: 'CRITIQUE' | 'MAJEUR' | 'MOD√âR√â' | 'MINEUR';
  description: string;
  dependencies: string[];
  vulnerabilities: string[];
  usageInWorkshop2: string[];
}

export interface CHUContext {
  organizationalScope: OrganizationalScope;
  businessStakes: BusinessStake[];
  regulatoryConstraints: RegulatoryConstraint[];
  securityObjectives: SecurityObjective[];
}

export interface OrganizationalScope {
  sites: SiteInfo[];
  employees: number;
  budget: string;
  specialties: string[];
  timeframe: string;
}

export interface SiteInfo {
  name: string;
  beds: number;
  specialties: string[];
  criticality: string;
}

export interface BusinessStake {
  category: 'vital' | 'economic' | 'regulatory' | 'strategic';
  description: string;
  priority: number;
  impact: string;
}

export interface RegulatoryConstraint {
  regulation: string;
  requirement: string;
  impact: string;
  compliance: string;
}

export interface SecurityObjective {
  domain: 'availability' | 'integrity' | 'confidentiality' | 'traceability';
  system: string;
  target: string;
  justification: string;
}

export interface EssentialAsset {
  id: string;
  name: string;
  category: 'process' | 'information' | 'system' | 'infrastructure' | 'human' | 'partner';
  criticality: 'CRITIQUE' | 'MAJEUR' | 'MOD√âR√â' | 'MINEUR';
  description: string;
  dependencies: string[];
  rto: string;
  rpo: string;
  impactAnalysis: ImpactAnalysis;
  relevantSources: string[];
}

export interface ImpactAnalysis {
  careImpact: number; // 1-5
  financialImpact: number; // 1-5
  regulatoryImpact: number; // 1-5
  reputationImpact: number; // 1-5
  globalScore: number;
}

export interface EcosystemDependency {
  id: string;
  name: string;
  type: 'technology_provider' | 'business_partner' | 'external_infrastructure' | 'service_provider';
  criticality: 'CRITIQUE' | 'MAJEUR' | 'MOD√âR√â' | 'MINEUR';
  services: string[];
  riskLevel: number;
  mitigationStrategies: string[];
  relevantSources: string[];
}

export interface Workshop2Orientation {
  prioritySources: PrioritySource[];
  sourceCategories: SourceCategory[];
  motivationMapping: MotivationMapping[];
  capacityRequirements: CapacityRequirement[];
}

export interface PrioritySource {
  category: string;
  priority: number;
  justification: string;
  relatedAssets: string[];
}

export interface SourceCategory {
  name: string;
  description: string;
  examples: string[];
  relevantAssets: string[];
}

export interface MotivationMapping {
  assetType: string;
  primaryMotivations: string[];
  secondaryMotivations: string[];
  examples: string[];
}

export interface CapacityRequirement {
  securityObjective: string;
  requiredCapacities: string[];
  sophisticationLevel: number;
  examples: string[];
}

/**
 * üéØ CLASSE PRINCIPALE D'INT√âGRATION A1 ‚Üí A2
 */
export class Workshop1ToWorkshop2Integration {
  
  // üìä DONN√âES SIMUL√âES ATELIER 1 (Contexte CHU)
  static getCHUContext(): CHUContext {
    return {
      organizationalScope: {
        sites: [
          { name: 'Site Principal', beds: 800, specialties: ['Urgences', 'R√©animation', 'Blocs'], criticality: 'CRITIQUE' },
          { name: 'Site Sp√©cialis√©', beds: 250, specialties: ['Cardiologie', 'Neurochirurgie'], criticality: 'MAJEUR' },
          { name: 'Centre Ambulatoire', beds: 150, specialties: ['Consultations', 'H√¥pital de jour'], criticality: 'MOD√âR√â' }
        ],
        employees: 3500,
        budget: '450M‚Ç¨/an',
        specialties: ['Urgences', 'R√©animation', 'Cardiologie', 'Neurochirurgie', 'Oncologie', 'P√©diatrie'],
        timeframe: '2024-2027'
      },
      businessStakes: [
        { category: 'vital', description: 'Continuit√© des soins 24h/24', priority: 1, impact: 'Vies en jeu' },
        { category: 'vital', description: 'S√©curit√© des patients et personnel', priority: 2, impact: 'Responsabilit√© p√©nale' },
        { category: 'regulatory', description: 'Conformit√© HDS, RGPD, HAS', priority: 3, impact: 'Sanctions, fermeture' },
        { category: 'economic', description: '√âquilibre financier T2A', priority: 4, impact: '450M‚Ç¨ budget' }
      ],
      regulatoryConstraints: [
        { regulation: 'HDS', requirement: 'H√©bergement donn√©es sant√© certifi√©', impact: 'Arr√™t activit√©', compliance: 'Obligatoire' },
        { regulation: 'RGPD', requirement: 'Protection donn√©es patients', impact: 'Amendes 4% CA', compliance: 'Obligatoire' },
        { regulation: 'HAS', requirement: 'Certification qualit√© soins', impact: 'Perte accr√©ditation', compliance: 'Obligatoire' },
        { regulation: 'ANSSI', requirement: 'D√©claration incidents >24h', impact: 'Sanctions administratives', compliance: 'Obligatoire' }
      ],
      securityObjectives: [
        { domain: 'availability', system: 'Urgences vitales', target: '99.99%', justification: 'Vies en jeu' },
        { domain: 'availability', system: 'SIH principal', target: '99.9%', justification: 'Activit√© hospitali√®re' },
        { domain: 'integrity', system: 'Prescriptions m√©dicales', target: '100%', justification: 'S√©curit√© patients' },
        { domain: 'confidentiality', system: 'Donn√©es patients', target: 'Secret m√©dical absolu', justification: 'Obligation l√©gale' }
      ]
    };
  }

  // üè• BIENS ESSENTIELS IDENTIFI√âS EN ATELIER 1
  static getEssentialAssets(): EssentialAsset[] {
    return [
      {
        id: 'urgences_vitales',
        name: 'Urgences vitales 24h/24',
        category: 'process',
        criticality: 'CRITIQUE',
        description: 'Processus d\'accueil, tri et soins d\'urgence vitale',
        dependencies: ['SIH', 'PACS', 'Laboratoires', 'Personnel m√©dical'],
        rto: '0 minute',
        rpo: '0 minute',
        impactAnalysis: {
          careImpact: 5,
          financialImpact: 4,
          regulatoryImpact: 4,
          reputationImpact: 5,
          globalScore: 5
        },
        relevantSources: [
          'Cybercriminels sp√©cialis√©s sant√© (impact maximal)',
          'Terroristes cyber (vies en jeu)',
          'Personnel urgences (acc√®s privil√©gi√©)',
          'Prestataires maintenance (√©quipements vitaux)'
        ]
      },
      {
        id: 'sih_dossiers_patients',
        name: 'SIH - Dossiers patients informatis√©s',
        category: 'information',
        criticality: 'CRITIQUE',
        description: '500k dossiers patients avec donn√©es sensibles RGPD',
        dependencies: ['Serveurs centraux', 'Bases de donn√©es', 'R√©seaux'],
        rto: '4 heures',
        rpo: '15 minutes',
        impactAnalysis: {
          careImpact: 4,
          financialImpact: 4,
          regulatoryImpact: 5,
          reputationImpact: 4,
          globalScore: 5
        },
        relevantSources: [
          'Trafiquants donn√©es m√©dicales (250‚Ç¨/dossier)',
          '√âtats √©trangers (espionnage donn√©es sant√©)',
          'Administrateurs IT (acc√®s technique complet)',
          'Personnel soignant (acc√®s fonctionnel large)'
        ]
      },
      {
        id: 'pacs_imagerie',
        name: 'PACS - Images m√©dicales',
        category: 'information',
        criticality: 'CRITIQUE',
        description: '500k images/an, diagnostics critiques',
        dependencies: ['Serveurs PACS', 'Stations visualisation', 'R√©seaux'],
        rto: '2 heures',
        rpo: '30 minutes',
        impactAnalysis: {
          careImpact: 4,
          financialImpact: 3,
          regulatoryImpact: 3,
          reputationImpact: 3,
          globalScore: 4
        },
        relevantSources: [
          'Espions industriels (innovations m√©dicales)',
          'Cybercriminels (chantage patients VIP)',
          'Radiologues (acc√®s privil√©gi√© images)',
          'Prestataires PACS (acc√®s technique)'
        ]
      },
      {
        id: 'laboratoires_analyses',
        name: 'Laboratoires d\'analyses',
        category: 'process',
        criticality: 'MAJEUR',
        description: 'Analyses biologiques urgentes et programm√©es',
        dependencies: ['Automates', 'LIS', 'Laboratoires externes'],
        rto: '1 heure',
        rpo: '1 heure',
        impactAnalysis: {
          careImpact: 3,
          financialImpact: 3,
          regulatoryImpact: 3,
          reputationImpact: 2,
          globalScore: 3
        },
        relevantSources: [
          'Laboratoires concurrents (espionnage)',
          'Fraudeurs sant√© (falsification r√©sultats)',
          'Biologistes (acc√®s r√©sultats sensibles)',
          'Prestataires automates (maintenance)'
        ]
      },
      {
        id: 'centre_donnees',
        name: 'Centre de donn√©es principal',
        category: 'infrastructure',
        criticality: 'CRITIQUE',
        description: '200 serveurs physiques, 800 virtuels',
        dependencies: ['Alimentations', 'Climatisation', 'R√©seaux', 'S√©curit√© physique'],
        rto: '4 heures',
        rpo: '1 heure',
        impactAnalysis: {
          careImpact: 5,
          financialImpact: 4,
          regulatoryImpact: 4,
          reputationImpact: 4,
          globalScore: 5
        },
        relevantSources: [
          'Cybercriminels (paralysie compl√®te)',
          'Menaces internes (acc√®s physique)',
          'Prestataires maintenance (acc√®s privil√©gi√©)',
          'Saboteurs (impact maximal)'
        ]
      }
    ];
  }

  // üåê √âCOSYST√àME ET D√âPENDANCES CRITIQUES
  static getEcosystemDependencies(): EcosystemDependency[] {
    return [
      {
        id: 'editeur_sih',
        name: '√âditeur SIH (fournisseur unique)',
        type: 'technology_provider',
        criticality: 'CRITIQUE',
        services: ['Support 24h/24', 'Maintenance', 'Mises √† jour'],
        riskLevel: 10, // Probabilit√© 2 √ó Impact 5
        mitigationStrategies: ['Contrat renforc√©', 'Plan de continuit√©', 'Escrow code'],
        relevantSources: [
          'Compromission √©diteur (backdoor)',
          'Employ√©s √©diteur m√©contents',
          'Concurrents (espionnage)',
          '√âtats √©trangers (supply chain)'
        ]
      },
      {
        id: 'operateur_telecom',
        name: 'Op√©rateur t√©l√©com principal',
        type: 'external_infrastructure',
        criticality: 'CRITIQUE',
        services: ['Connectivit√© inter-sites', 'Internet', 'VPN'],
        riskLevel: 12, // Probabilit√© 3 √ó Impact 4
        mitigationStrategies: ['Double op√©rateur', 'Liaisons secours', 'Monitoring'],
        relevantSources: [
          'Panne op√©rateur (technique)',
          'Cyberattaque infrastructure',
          'Sabotage physique liaisons',
          'Employ√©s op√©rateur (acc√®s)'
        ]
      },
      {
        id: 'laboratoires_externes',
        name: 'Laboratoires externes (8 partenaires)',
        type: 'business_partner',
        criticality: 'CRITIQUE',
        services: ['Analyses urgentes', 'Analyses sp√©cialis√©es'],
        riskLevel: 8, // Probabilit√© 2 √ó Impact 4
        mitigationStrategies: ['Multi-sourcing', 'Contrats SLA', 'Monitoring'],
        relevantSources: [
          'Compromission laboratoire ‚Üí CHU',
          'Concurrents laboratoires',
          'Employ√©s laboratoires',
          'Interception transports'
        ]
      }
    ];
  }

  // üéØ ORIENTATIONS POUR ATELIER 2
  static getWorkshop2Orientations(): Workshop2Orientation {
    return {
      prioritySources: [
        {
          category: 'Cybercriminels sp√©cialis√©s sant√©',
          priority: 1,
          justification: 'Ciblent sp√©cifiquement les h√¥pitaux, ran√ßons √©lev√©es',
          relatedAssets: ['urgences_vitales', 'sih_dossiers_patients', 'centre_donnees']
        },
        {
          category: '√âtats √©trangers (espionnage)',
          priority: 2,
          justification: 'Int√©r√™t pour recherche m√©dicale et donn√©es sant√©',
          relatedAssets: ['sih_dossiers_patients', 'pacs_imagerie']
        },
        {
          category: 'Menaces internes privil√©gi√©es',
          priority: 3,
          justification: 'Acc√®s l√©gitime aux biens critiques',
          relatedAssets: ['urgences_vitales', 'sih_dossiers_patients', 'centre_donnees']
        }
      ],
      sourceCategories: [
        {
          name: 'Sources externes sp√©cialis√©es',
          description: 'Menaces ciblant sp√©cifiquement le secteur sant√©',
          examples: ['Groupes ransomware sant√©', 'Trafiquants donn√©es m√©dicales', 'APT recherche m√©dicale'],
          relevantAssets: ['sih_dossiers_patients', 'pacs_imagerie', 'urgences_vitales']
        },
        {
          name: 'Sources internes hospitali√®res',
          description: 'Personnel et prestataires avec acc√®s privil√©gi√©',
          examples: ['Administrateurs IT', 'Personnel m√©dical', 'Prestataires maintenance'],
          relevantAssets: ['centre_donnees', 'urgences_vitales', 'laboratoires_analyses']
        },
        {
          name: 'Sources √©cosyst√®me sant√©',
          description: 'Compromission via partenaires et fournisseurs',
          examples: ['√âditeurs logiciels', 'Laboratoires externes', 'Prestataires cloud'],
          relevantAssets: ['sih_dossiers_patients', 'laboratoires_analyses']
        }
      ],
      motivationMapping: [
        {
          assetType: 'Urgences vitales',
          primaryMotivations: ['Impact maximal (vies)', 'Pression paiement'],
          secondaryMotivations: ['M√©diatisation', 'D√©stabilisation'],
          examples: ['Ransomware urgences', 'Terrorisme cyber', 'Sabotage interne']
        },
        {
          assetType: 'Donn√©es patients',
          primaryMotivations: ['Valeur commerciale', 'Chantage'],
          secondaryMotivations: ['Espionnage', 'Fraude'],
          examples: ['Revente march√© noir', 'Usurpation identit√©', 'Intelligence √©conomique']
        }
      ],
      capacityRequirements: [
        {
          securityObjective: 'Disponibilit√© 99.99% urgences',
          requiredCapacities: ['DDoS massifs', 'Ransomware sophistiqu√©', 'Coordination multi-vecteurs'],
          sophisticationLevel: 8,
          examples: ['Botnet >100k machines', 'Ransomware avec destruction sauvegardes']
        },
        {
          securityObjective: 'Int√©grit√© 100% prescriptions',
          requiredCapacities: ['Acc√®s bases donn√©es', 'Modification discr√®te', 'Connaissance m√©dicale'],
          sophisticationLevel: 6,
          examples: ['Corruption admin IT', 'Malware cibl√© SIH', 'Ing√©nierie sociale m√©decins']
        }
      ]
    };
  }

  // üîÑ M√âTHODES DE TRANSFORMATION A1 ‚Üí A2
  static transformEssentialAssetsToSources(): string[] {
    const assets = this.getEssentialAssets();
    const allSources: string[] = [];
    
    assets.forEach(asset => {
      allSources.push(...asset.relevantSources);
    });
    
    // D√©doublonnage et tri par priorit√©
    return [...new Set(allSources)].sort();
  }

  static getSourcePriorityByAssetCriticality(assetId: string): number {
    const asset = this.getEssentialAssets().find(a => a.id === assetId);
    if (!asset) return 0;
    
    switch (asset.criticality) {
      case 'CRITIQUE': return 1;
      case 'MAJEUR': return 2;
      case 'MOD√âR√â': return 3;
      case 'MINEUR': return 4;
      default: return 5;
    }
  }

  static generateHandoverDocument(): any {
    return {
      context: this.getCHUContext(),
      essentialAssets: this.getEssentialAssets(),
      ecosystem: this.getEcosystemDependencies(),
      orientations: this.getWorkshop2Orientations(),
      metadata: {
        generatedAt: new Date().toISOString(),
        version: '1.0',
        workshop: 'A1 ‚Üí A2 Integration',
        status: 'Ready for Workshop 2'
      }
    };
  }
}
